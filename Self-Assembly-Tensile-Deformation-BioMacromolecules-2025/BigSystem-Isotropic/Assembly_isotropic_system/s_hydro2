######### 3d Lennard-Jones for polymeric system ############# 
######## simulting polymer brush by "grafting from" approach##
##### study the effect of iniatior density embedded in the #### #### substrate on chain length disbribution and polydispersity### 

units		lj
atom_style	atomic
boundary        p p p 
########## configure the simulation setup ############
read_data	s1.data nocoeff
variable        rho equal 2/(2*2^(1./6.))^3 

variable        dimx equal 16*4
variable        dimy equal 8*2
variable        dimz equal 8*2

region	end block  0 2 INF INF INF INF units box

#mass (soft segment = 1.0 / hard segment = 1.0)
variable        mass5 equal 1.0
mass            * 1.0
mass            1 0.2
mass            2 0.2
mass            3 0.1
mass            4 0.1
mass            5 0.35 #solvent mass

mass            6 0.1
mass            7 1.0
mass            8 1.0

###### randomly reset some of the bottom substrate atoms to radical atoms ####

group           patch4 type 4
group           patch1 type 1
group           patch2 type 2
group           patch3 type 3
group           patch6 type 6
group           patch5 type 5
group           patch7 type 7
group           patch8 type 8
#delete_atoms   group patch6
group           patch9 type 9
delete_atoms    group patch9
#delete_atoms    group patch3
#delete_atoms    group patch4
#delete_atoms    group patch6


#temperature is 0.028 before
variable	t equal 0.04
variable	tf equal 0.04
velocity	all create $t 2787

#c is 2.35 before for chains, 1.9 for very compact
variable        c equal 1.8
variable        s equal $c/2^(1./6.)

#variable        m equal ${shift}/2^(1./6.)
#variable        n equal $m*1.6

variable        u equal 1.0
variable        v equal $u/2^(1./6.)

variable        p equal 1.0
variable        q equal $p/2^(1./6.)

variable        h equal 1.0
variable        k equal $h/2^(1./6.)

variable        h2 equal 1.0
variable        k2 equal ${h2}/2^(1./6.)

variable        h3 equal sqrt(2.0) # 1.414
variable        k3 equal ${h3}/2^(1./6.)

variable        b equal 0.2
variable        b1 equal 0.14

variable        c3 equal 2.0
variable        s3 equal ${c3}/2^(1./6.)

variable        c5 equal 1.6
variable        s5 equal ${c5}/2^(1./6.)

variable        h4 equal 0.5
variable        k4 equal ${h4}/2^(1./6.)

variable        h5 equal 0.50
variable        k5 equal ${h5}/2^(1./6.)

variable        c4 equal 0.707
variable        s4 equal ${c4}/2^(1./6.)

variable        c6 equal 2.5
variable        s6 equal ${c6}/2^(1./6.)

variable        c7 equal 2.8
variable        s7 equal ${c7}/2^(1./6.)

#pair_style     lj/cut/bump/smooth/linear 2.5
pair_style      lj/cut/bump 2.8 #cutoff 2.8
pair_coeff      * * 0.02 $v 1.0 1 0 $u

#backbone
#in hard segment
pair_coeff      1 1 20.0 $s  1.0 1 0 1.8 #1.8 only repulsion
pair_coeff      2 2 20.0 $s  1.0 1 0 1.8 #1.8 only repulsion
pair_coeff      1 2 20.0 ${k2} 1.2 1 1.0 1.8 #1 strong bond

#connect soft segments in outside and inside hard segments
pair_coeff      2 7 20.0 ${k2} 1.2 1 1.0 1.8 #1 strong bond
pair_coeff      1 8 20.0 ${k2} 1.2 1 1.0 1.8 #1 strong bond
pair_coeff      1 7 20.0 $s  1.0 1 0 1.8 #1.8 only repulsion
pair_coeff      2 8 20.0 $s  1.0 1 0 1.8 #1.8 only repulsion

#soft segment (distance between soft/soft = 2.2)
pair_coeff      7 7 20.0 $s  1.0 1 0 1.8 #1.8 only repulsion
pair_coeff      8 8 20.0 $s  1.0 1 0 1.8 #1.8 only repulsion
pair_coeff      7 8 20.0 ${k2} 1.2 1 1.0 1.8 #1 strong bond

#intramolecular interactions in hard segments
pair_coeff      1 3 20.0 ${k4} 1.2 1 2.0 1.118 #0.5 strong bond
pair_coeff      2 3 20.0 ${k4} 1.2 1 2.0 1.118 #0.5 strong bond
pair_coeff      1 4 20.0 ${k4} 1.2 1 2.0 1.118 #0.5 strong bond
pair_coeff      2 4 20.0 ${k4} 1.2 1 2.0 1.118 #0.5 strong bond
pair_coeff      1*2 6 20.0 ${s4} 1.2 1 2.0 1.225 #0.707 strong bond

pair_coeff      3 4 20.0 ${s4} 1.2 1 2.0 1.225 #0.707 weak bond ####
pair_coeff      3*4 6 20.0 ${k4} 1.2 1 2.0 1.118 #0.5 strong bond
#pair_coeff      3*4 6 0.01 ${k5} 1.2 1 0.0 0.50 #0.50 only repulsion ####

#pair_coeff      3 3 10.0 ${k2} 1.2 1 1.0 1.2 #1 strong bond_initial
#pair_coeff      4 4 10.0 ${k2} 1.2 1 1.0 1.2 #1 strong bond_initial

pair_coeff      6 6 5.0 ${k2} 1.16 1.0 2.0 1.12 #1 strong bond ####

#intermolecular interactions between soft and hard segments

pair_coeff      3*4 7 0.01 ${k4} 1.2 1 0.0 0.5 #0.5 only repulsion
pair_coeff      3*4 8 0.01 ${k4} 1.2 1 0.0 0.5 #0.5 only repulsion
pair_coeff      6 7 0.01 ${k4} 1.2 1 0.0 0.5 #0.5 only repulsion
pair_coeff      6 8 0.01 ${k4} 1.2 1 0.0 0.5 #0.5 only repulsion

#turn on hydrophobic interaction of solvent particles
variable        c8 equal 2.0
variable        s8 equal ${c8}/2^(1./6.)

variable        c9 equal 2.2
variable        s9 equal ${c9}/2^(1./6.)

variable        c10 equal 0.3
variable        s10 equal ${c10}/2^(1./6.)

pair_coeff      1*2 5 0.05 ${s9} 1.2 1 0.0 2.2 # 2.2 only repulsion

pair_coeff      3*4 5 0.01 ${s10} 1.2 1 0.0 0.3 #only repulsion
pair_coeff      5 6 0.01 ${s10} 1.2 1 0.0 0.3 #only repulsion

#turn on 33bond and 44bond
pair_coeff      3 3 2.5 ${k2} 1.1 0.415 2.0 2.8 #1 strong bond
pair_coeff      4 4 2.5 ${k2} 1.1 0.475 2.0 2.8 #1 strong bond

#solvent behavior
pair_coeff      5 5 0.05 ${s9} 1.2 1 0.0 2.2 # 2.2 only repulsion

pair_coeff      5 7 0.05 ${s8} 1.2 1 0.0 2.8 # 2.0 attraction
pair_coeff      5 8 0.05 ${s8} 1.2 1 0.0 2.8 # 2.0 attraction

pair_modify     tail no
pair_modify     shift yes
neighbor        0.5 bin
neigh_modify    every 1 delay 0 check yes
#neigh_modify    page 100000000000
#neigh_modify    one  10000000000

timestep        0.001
thermo          2000
thermo_style    custom step temp pe ke etotal pxx pyy pzz lx ly lz press vol



dump            1 all custom 100000 lata4olivia_assembly id type x y z fx fy fz vx vy vz
################relaxation (P drop)######################
#minimize        1e-5 1e-6 100000 100000
fix		1 all nvt temp ${tf} ${tf} 0.01
run		500000 #pre-assemble
unfix           1

################P change into 0.001######################
variable        pressurenow equal press
fix             1 all npt temp ${tf} ${tf} 0.01 iso ${pressurenow} 0.001 10 
run             100000
unfix           1

################the first compression at low P (P = 0.001) and dehydration##############
fix             1 all npt temp ${tf} ${tf} 0.01 iso 0.001 0.001 10

variable a loop 400
label loop
                group g5 type 5 5

variable        n5 equal count(g5)
variable        rmn equal 3925 #dehydration amount 3925, for the original sample replication of 72x4x4, for smaller sample of 8x2x2, should be 36 times smaller
variable        fraction equal ${rmn}/${n5}
if "${fraction} > 1.0" then "jump s_hydro2 breakloop"
                set group g5 type/fraction 9 ${fraction} 11

                group g9 type 9 9
                delete_atoms group g9
                group g5 delete
                group g9 delete
run             5000
next a
jump s_hydro2 loop

label			breakloop
print			"out of loop, fraction is ${fraction}"

unfix           1
############turn on Hbond in soft segments###################
pair_coeff      7 8 10.0 ${k2} 1.2 0.79 1.0 2.8 #1 strong bond/2.2 attraction


pair_modify     tail no
pair_modify     shift yes
neighbor        0.5 bin
neigh_modify    every 1 delay 0 check yes


#################P change into 1######################
variable        pressurenow equal press
fix             1 all npt temp ${tf} ${tf} 0.01 iso ${pressurenow} 1 10
run             100000
unfix           1
################the second compression at high P (P = 1)##############
fix		1 all npt temp ${tf} ${tf} 0.01 iso 1 1 10
run		300000
unfix           1

###############decompression##########################################
variable       finalpress equal press
fix             1 all npt temp ${tf} ${tf} 0.01 iso ${finalpress} 0.0 10
run            200000
unfix          1

###############maintain pressure_relaxation############################
fix             1 all npt temp ${tf} ${tf} 0.01 x 0.0 0.0 5.0 y 0.0 0.0 5.0 z 0.0 0.0 5.0
run            200000
unfix          1

write_data    resultingsilk.data
